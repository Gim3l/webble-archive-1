# Migration `20201025024608-fresh`

This migration has been generated by Gimel Dick at 10/24/2020, 10:46:08 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "User" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL,
    "email" TEXT NOT NULL,
    "hashedPassword" TEXT,
    "role" TEXT NOT NULL DEFAULT 'user',
    "firstName" TEXT NOT NULL,
    "lastName" TEXT NOT NULL
)

CREATE TABLE "Session" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL,
    "expiresAt" DATETIME,
    "handle" TEXT NOT NULL,
    "userId" INTEGER,
    "hashedSessionToken" TEXT,
    "antiCSRFToken" TEXT,
    "publicData" TEXT,
    "privateData" TEXT,

    FOREIGN KEY ("userId") REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE
)

CREATE TABLE "Project" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL,
    "name" TEXT NOT NULL
)

CREATE TABLE "Exam" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "name" TEXT NOT NULL,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL
)

CREATE TABLE "Classroom" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "name" TEXT NOT NULL,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL,
    "code" TEXT NOT NULL,
    "colour" TEXT NOT NULL DEFAULT 'primary'
)

CREATE TABLE "TeacherProfile" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "userId" INTEGER NOT NULL,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL,

    FOREIGN KEY ("userId") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "StudentProfile" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "userId" INTEGER NOT NULL,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL,

    FOREIGN KEY ("userId") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "TeacherProfileOnClassroom" (
    "teacherProfileId" INTEGER NOT NULL,
    "classroomId" INTEGER NOT NULL,

    FOREIGN KEY ("classroomId") REFERENCES "Classroom"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ("teacherProfileId") REFERENCES "TeacherProfile"("id") ON DELETE CASCADE ON UPDATE CASCADE,
PRIMARY KEY ("teacherProfileId","classroomId")
)

CREATE TABLE "StudentProfileOnClassroom" (
    "studentProfileId" INTEGER NOT NULL,
    "classroomId" INTEGER NOT NULL,

    FOREIGN KEY ("classroomId") REFERENCES "Classroom"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ("studentProfileId") REFERENCES "StudentProfile"("id") ON DELETE CASCADE ON UPDATE CASCADE,
PRIMARY KEY ("studentProfileId","classroomId")
)

CREATE TABLE "Grade" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "amountReceived" INTEGER NOT NULL,
    "total" INTEGER NOT NULL
)

CREATE TABLE "GradeOnStudentProfile" (
    "gradeId" INTEGER NOT NULL,
    "studentId" INTEGER NOT NULL,
    "classroomId" INTEGER NOT NULL,

    FOREIGN KEY ("classroomId") REFERENCES "Classroom"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ("gradeId") REFERENCES "Grade"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ("studentId") REFERENCES "StudentProfile"("id") ON DELETE CASCADE ON UPDATE CASCADE,
PRIMARY KEY ("gradeId","studentId")
)

CREATE TABLE "Topic" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "name" TEXT NOT NULL
)

CREATE TABLE "Assignment" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "name" TEXT,
    "description" TEXT NOT NULL,
    "classroomId" INTEGER NOT NULL,

    FOREIGN KEY ("classroomId") REFERENCES "Classroom"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "GradeOnAssignment" (
    "gradeId" INTEGER NOT NULL,
    "assignmentId" INTEGER NOT NULL,

    FOREIGN KEY ("assignmentId") REFERENCES "Assignment"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ("gradeId") REFERENCES "Grade"("id") ON DELETE CASCADE ON UPDATE CASCADE,
PRIMARY KEY ("gradeId","assignmentId")
)

CREATE TABLE "ResourceFolder" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "name" TEXT NOT NULL,
    "classroomId" INTEGER NOT NULL,
    "colour" TEXT NOT NULL DEFAULT 'primary',

    FOREIGN KEY ("classroomId") REFERENCES "Classroom"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "File" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "name" TEXT NOT NULL,
    "path" TEXT NOT NULL,
    "size" INTEGER NOT NULL,
    "resourceFolderId" INTEGER NOT NULL,

    FOREIGN KEY ("resourceFolderId") REFERENCES "ResourceFolder"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE UNIQUE INDEX "User.email_unique" ON "User"("email")

CREATE UNIQUE INDEX "Session.handle_unique" ON "Session"("handle")

CREATE UNIQUE INDEX "Classroom.code_unique" ON "Classroom"("code")

CREATE UNIQUE INDEX "TeacherProfile.userId_unique" ON "TeacherProfile"("userId")

CREATE UNIQUE INDEX "StudentProfile.userId_unique" ON "StudentProfile"("userId")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201024220300..20201025024608-fresh
--- datamodel.dml
+++ datamodel.dml
@@ -1,44 +1,39 @@
-// This is your Prisma schema file,
-// learn more about it in the docs: https://pris.ly/d/prisma-schema
+generator client {
+  provider = "prisma-client-js"
+}
 datasource db {
   provider = "sqlite"
-  url = "***"
+  url = "***"
 }
-generator client {
-  provider = "prisma-client-js"
-}
-
-// --------------------------------------
-
 model User {
-  id             Int              @id @default(autoincrement())
-  createdAt      DateTime         @default(now())
-  updatedAt      DateTime         @updatedAt
+  id             Int             @id @default(autoincrement())
+  createdAt      DateTime        @default(now())
+  updatedAt      DateTime        @updatedAt
+  email          String          @unique
+  hashedPassword String?
+  role           String          @default("user")
   firstName      String
   lastName       String
-  email          String           @unique
-  hashedPassword String?
-  role           String           @default("user")
   sessions       Session[]
   TeacherProfile TeacherProfile?
-  StudentProfile StudentProfile[]
+  StudentProfile StudentProfile?
 }
 model Session {
   id                 Int       @id @default(autoincrement())
   createdAt          DateTime  @default(now())
   updatedAt          DateTime  @updatedAt
   expiresAt          DateTime?
   handle             String    @unique
-  user               User?     @relation(fields: [userId], references: [id])
   userId             Int?
   hashedSessionToken String?
   antiCSRFToken      String?
   publicData         String?
   privateData        String?
+  user               User?     @relation(fields: [userId], references: [id])
 }
 model Project {
   id        Int      @id @default(autoincrement())
@@ -56,70 +51,71 @@
 model Classroom {
   id                        Int                         @id @default(autoincrement())
   name                      String
-  code                      String                      @unique
   createdAt                 DateTime                    @default(now())
   updatedAt                 DateTime                    @updatedAt
+  code                      String                      @unique
+  colour                    String                      @default("primary")
   TeacherProfileOnClassroom TeacherProfileOnClassroom[]
   StudentProfileOnClassroom StudentProfileOnClassroom[]
   GradeOnStudentProfile     GradeOnStudentProfile[]
   ResourceFolder            ResourceFolder[]
-  colour                    String                      @default("primary")
+  Assignment                Assignment[]
 }
 model TeacherProfile {
   id                        Int                         @id @default(autoincrement())
-  user                      User                        @relation(fields: [userId], references: [id])
   userId                    Int                         @unique
   createdAt                 DateTime                    @default(now())
   updatedAt                 DateTime                    @updatedAt
+  user                      User                        @relation(fields: [userId], references: [id])
   TeacherProfileOnClassroom TeacherProfileOnClassroom[]
 }
 model StudentProfile {
   id                        Int                         @id @default(autoincrement())
-  user                      User                        @relation(fields: [userId], references: [id])
   userId                    Int                         @unique
   createdAt                 DateTime                    @default(now())
   updatedAt                 DateTime                    @updatedAt
+  user                      User                        @relation(fields: [userId], references: [id])
   StudentProfileOnClassroom StudentProfileOnClassroom[]
   GradeOnStudentProfile     GradeOnStudentProfile[]
 }
 model TeacherProfileOnClassroom {
-  teacherProfile   TeacherProfile @relation(fields: [teacherProfileId], references: [id])
   teacherProfileId Int
+  classroomId      Int
   classroom        Classroom      @relation(fields: [classroomId], references: [id])
-  classroomId      Int
+  teacherProfile   TeacherProfile @relation(fields: [teacherProfileId], references: [id])
   @@id([teacherProfileId, classroomId])
 }
 model StudentProfileOnClassroom {
-  studentProfile   StudentProfile @relation(fields: [studentProfileId], references: [id])
   studentProfileId Int
+  classroomId      Int
   classroom        Classroom      @relation(fields: [classroomId], references: [id])
-  classroomId      Int
+  studentProfile   StudentProfile @relation(fields: [studentProfileId], references: [id])
   @@id([studentProfileId, classroomId])
 }
 model Grade {
   id                    Int                     @id @default(autoincrement())
   amountReceived        Int
   total                 Int
+  GradeOnAssignment     GradeOnAssignment[]
   GradeOnStudentProfile GradeOnStudentProfile[]
-  GradeOnAssignment     GradeOnAssignment[]
 }
 model GradeOnStudentProfile {
-  grade       Grade          @relation(fields: [gradeId], references: [id])
   gradeId     Int
-  student     StudentProfile @relation(fields: [studentId], references: [id])
   studentId   Int
+  classroomId Int
   classroom   Classroom      @relation(fields: [classroomId], references: [id])
-  classroomId Int
+  grade       Grade          @relation(fields: [gradeId], references: [id])
+  student     StudentProfile @relation(fields: [studentId], references: [id])
   @@id([gradeId, studentId])
 }
@@ -131,35 +127,35 @@
 model Assignment {
   id                Int                 @id @default(autoincrement())
   name              String?
   description       String
-  classroom         Classroom? @relation(fields: [classroomId], references: [id])
-  classroomId       Int?
+  classroomId       Int
+  classroom         Classroom           @relation(fields: [classroomId], references: [id])
   GradeOnAssignment GradeOnAssignment[]
 }
 model GradeOnAssignment {
-  grade        Grade      @relation(fields: [gradeId], references: [id])
   gradeId      Int
+  assignmentId Int
   assignment   Assignment @relation(fields: [assignmentId], references: [id])
-  assignmentId Int
+  grade        Grade      @relation(fields: [gradeId], references: [id])
   @@id([gradeId, assignmentId])
 }
 model ResourceFolder {
   id          Int       @id @default(autoincrement())
   name        String
-  classroom   Classroom @relation(fields: [classroomId], references: [id])
   classroomId Int
   colour      String    @default("primary")
+  classroom   Classroom @relation(fields: [classroomId], references: [id])
   files       File[]
 }
 model File {
   id               Int            @id @default(autoincrement())
   name             String
   path             String
   size             Int
+  resourceFolderId Int
   resourceFolder   ResourceFolder @relation(fields: [resourceFolderId], references: [id])
-  resourceFolderId Int
 }
```


